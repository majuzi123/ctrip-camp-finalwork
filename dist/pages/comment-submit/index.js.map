{"version":3,"file":"pages/comment-submit/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAhDA;AAAA;AAAA;AAkDA;AACA;AAAA;AAEA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1HA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AAAA;AAEA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAjBA;AAAA;AAAA;;AAmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAEA;AAAA;AAGA;AAAA;;;;;;;;;;;;;;;;;ACnEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAGA;AAAA;;;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://xiecheng-final-work/._src_pages_comment-submit_index.jsx","webpack://xiecheng-final-work/._src_components_ImageAdder_index.jsx","webpack://xiecheng-final-work/._src_components_ScoreChecker_index.jsx","webpack://xiecheng-final-work/./src/pages/comment-submit/index.jsx?b16a","webpack://xiecheng-final-work/._node_modules_@babel_runtime_helpers_esm_createForOfIteratorHelper.js"],"sourcesContent":["import { useState } from 'react'\nimport { View, Text, Button, Checkbox, Textarea } from '@tarojs/components'\nimport Taro, { useLoad } from '@tarojs/taro';\nimport './index.scss'\nimport ScoreChecker from '../../components/ScoreChecker';\nimport ImageAdder from '../../components/ImageAdder';\n\nexport default function Index() {\n  const [hotelName, setHotelName] = useState('');\n  const [hotelId, setHotelId] = useState('');\n  const [cScore, setCScore] = useState(0);//评分\n  const [cText, setCText] = useState('');//文字评论\n  const [cImgs, setCImgs] = useState([]);//评论图片\n  const [anonymous, setAnonymous] = useState(false);//是否匿名提交点评\n\n  useLoad((options) => {\n    console.log(options)\n    setHotelName(options.hotelName)\n    setHotelId(options.hotelId)\n\n    //请求地址信息,获取评论时的ip属地\n    if (!global.city) {\n      global.city = '未知属地'\n      Taro.request({\n        url: 'https://whois.pconline.com.cn/ipJson.jsp?json=true',\n        header: {\n          'content-type': 'application/json'\n        },\n        success: function (res) {\n          if (res.data.pro == res.data.city) {//直辖市\n            global.city = res.data.city\n          } else {\n            global.city = res.data.pro + ' ' + res.data.city;\n          }\n          console.log(city)\n        }\n      })\n    }\n  })\n\n  //获取ScoreChecker组件状态的回调函数\n  const handleScoreChange = (score) => {\n    setCScore(score)\n  }\n\n  //获取ImageAdder组件状态的回调函数\n  const handleImgsChange = (imgs) => {\n    setCImgs(imgs)\n  }\n\n  //点击提交点评后的操作\n  const submitComment = async () => {\n    console.log(\"clicked submit\")\n    if (!anonymous) {//暂时只实现匿名评论\n      Taro.showToast({ title: '请匿名点评', icon: 'error', duration: 1000 })\n      return;\n    }\n    if (cScore == 0) {\n      Taro.showToast({ title: '请先评分', icon: 'error', duration: 1000 })\n      return;\n    }\n    if (cText.length < 5) {\n      Taro.showToast({ title: '评价字数过少', icon: 'error', duration: 1000 })\n      return;\n    }\n    Taro.showModal({\n      title: '确认提交评价？',\n      success: (res) => {\n        if (res.confirm) {\n          console.log(\"submit to server...\")\n          Taro.showLoading({\n            title: '提交评价ing...'\n          })\n          Taro.cloud.callFunction({\n            name: 'submit-comment',//提交点评至数据库\n            data: {\n              hotelName: hotelName ? hotelName : '未知酒店',\n              hotelId: hotelId ? hotelId : '00000',\n              liveTime: new Date().valueOf(),   //当前点评时间\n              location: city ? city : '未知属地',//当前所处城市\n              nickname: !anonymous && userInfo.nickName ? userInfo.nickName : '匿名用户',\n              userImg: !anonymous && userInfo.avatarUrl ? userInfo.avatarUrl : 'https://pic.imgdb.cn/item/64395c040d2dde5777264e41.jpg',\n              star: cScore,    //评分\n              content: cText,  //文字评价\n              ImgList: cImgs,  //图片\n              pass: null       //审核状态，null未审核，true通过，false拒绝\n            }\n          }).then((res) => {\n            Taro.hideLoading()\n            if (res.errMsg != \"cloud.callFunction:ok\") {\n              Taro.showToast({ title: '提交失败', icon: 'error', duration: 1000 })\n            } else {\n              Taro.showToast({ title: '提交成功', icon: 'success', duration: 1000 })\n              setTimeout(() => { Taro.navigateBack() }, 1000)\n            }\n          })\n        }\n      }\n    })\n  }\n\n  return (\n    <View className='comment-submit-page'>\n\n      <View className='hotel-name'>{hotelName}</View>\n\n      <ScoreChecker title={'评分：'} starSize={'60rpx'} score={cScore} onChangeScore={handleScoreChange} />\n\n      <View className='comment-text'>\n        <Text className='text-tips1'>{cText == '' ? '欢迎你分享对酒店服务、环境、设施和价格等的评价...' : ''}</Text>\n        <Textarea className='text-content' value={cText} type='text' onInput={(e) => { setCText(e.target.value) }} />\n        <View className='text-tips2'>至少5个字</View>\n      </View>\n\n      <ImageAdder IMG_MAX_COUNT={9} uploadToCloud={true} imgsList={cImgs} onChangeImgs={handleImgsChange} />\n\n      <Checkbox className='anonymous-check' onClick={() => { setAnonymous(!anonymous) }} checked={anonymous}>匿名评论</Checkbox>\n\n      <Button className='submit-btn' onClick={submitComment}>提交</Button>\n\n    </View>\n  )\n}\n","import { View, Image } from '@tarojs/components'\r\nimport Taro, { useLoad } from '@tarojs/taro';\r\nimport './index.scss'\r\nimport IconFont from '../iconfont';\r\n// {/* 选择并添加图片 */}\r\nexport default function ImageAdder({\r\n    IMG_MAX_COUNT,//图片最大数量\r\n    uploadToCloud,\r\n    imgsList,\r\n    onChangeImgs\r\n}) {\r\n    if (!IMG_MAX_COUNT) {\r\n        var IMG_MAX_COUNT = 9\r\n    }\r\n\r\n    //添加点评图片\r\n    const addImg = async () => {\r\n        console.log(\"addImg\")\r\n        var imgs = [...imgsList]\r\n        const res = await Taro.chooseImage({ count: IMG_MAX_COUNT - imgsList.length, sizeType: ['compressed'] })\r\n        if (uploadToCloud && uploadToCloud === true) {\r\n            for (let path of res.tempFilePaths) {\r\n                let cloudPath = 'comment-img/' + Date.now() + Math.floor(Math.random() * 10000) + '.jpg';\r\n                await Taro.cloud.uploadFile({ cloudPath: cloudPath, filePath: path }).then(//图片上传\r\n                    (res) => {\r\n                        imgs.push(res.fileID)\r\n                    }\r\n                )\r\n            }\r\n        } else {\r\n            imgs.push(res.tempFilePaths)\r\n        }\r\n        onChangeImgs(imgs)\r\n    }\r\n\r\n    //删除指定的已添加的点评图片\r\n    const deleteImg = (index) => {\r\n        console.log(\"deleteImg\" + index)\r\n        var imgs = [...imgsList]\r\n        var newCImg = []\r\n        for (let i = 0; i < imgs.length; i++) {\r\n            if (i != index) {\r\n                newCImg.push(imgs[i])\r\n            }\r\n        }\r\n        onChangeImgs(newCImg)\r\n    }\r\n\r\n\r\n    return (\r\n        <View className='image-adder-container'>\r\n            {imgsList.map((src, index) => (\r\n                <View className='img-container'>\r\n                    <Image src={src} className='comment-img' lazyLoad></Image>\r\n                    <View className='delete-btn' onClick={() => { deleteImg(index) }}>\r\n                        <IconFont name='times-circle-fill' size='32rpx' color='red'></IconFont>\r\n                    </View>\r\n                </View>\r\n            ))}\r\n\r\n            {imgsList.length < IMG_MAX_COUNT && <View className='img-container adder-icon' onClick={addImg}>\r\n                {/* 触发添加图片的加号 */}\r\n                <IconFont name='tupian' color='rgb(211, 176, 243)' size='120rpx' />\r\n                添加图片\r\n            </View>}\r\n        </View>\r\n    )\r\n}","import { View, Text } from '@tarojs/components'\r\nimport './index.scss'\r\nimport IconFont from '../iconfont';\r\n// {/* 选择评分组件 */}\r\nexport default function ScoreChecker({\r\n    starSize,\r\n    fontSize,\r\n    score,\r\n    onChangeScore,\r\n    title\r\n}) {\r\n    if (!starSize) {\r\n        var starSize = '48rpx'\r\n    }\r\n\r\n    return (\r\n        <View className='score-checker-container'>\r\n            <Text className='score-title'>{title}</Text>\r\n            <View className='stars'>{[1, 2, 3, 4, 5].map((value) => {\r\n                let colour = value <= score ? 'yellow' : \"#ccc\"\r\n                return (<View onClick={() => { onChangeScore(value) }} >\r\n                    <IconFont className='star' name='a-1' color={colour} size={starSize} />\r\n                </View>)\r\n            })}</View>\r\n        </View>\r\n    )\r\n}","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/babel-loader/lib/index.js??ruleSet[1].rules[5].use[0]!./index.jsx\"\nvar config = {\"navigationBarTitleText\":\"点评提交\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/comment-submit/index', {root:{cn:[]}}, config || {}))\n\n\n","import unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nexport default function _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (!it) {\n    if (Array.isArray(o) || (it = unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}"],"names":[],"sourceRoot":""}