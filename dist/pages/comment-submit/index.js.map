{"version":3,"file":"pages/comment-submit/index.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAbA;AAAA;AAAA;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAzCA;AAAA;AAAA;AA2CA;AACA;AAAA;AACA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAGA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAIA;;;;;;;;;;;;;AC5HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACPA;AACA;AACA;AACA;;;;;;;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACnDA;AACA;AACA;;;;;;;;;;;;;ACFA;AACA;AACA;;;;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://xiecheng-final-work/._src_pages_comment-submit_index.jsx","webpack://xiecheng-final-work/./src/pages/comment-submit/index.jsx?b16a","webpack://xiecheng-final-work/._node_modules_@babel_runtime_helpers_esm_arrayWithoutHoles.js","webpack://xiecheng-final-work/._node_modules_@babel_runtime_helpers_esm_createForOfIteratorHelper.js","webpack://xiecheng-final-work/._node_modules_@babel_runtime_helpers_esm_iterableToArray.js","webpack://xiecheng-final-work/._node_modules_@babel_runtime_helpers_esm_nonIterableSpread.js","webpack://xiecheng-final-work/._node_modules_@babel_runtime_helpers_esm_toConsumableArray.js"],"sourcesContent":["import { Component, useState } from 'react'\nimport { View, Text, Input, Button, Checkbox, Image } from '@tarojs/components'\nimport Taro, { useLoad } from '@tarojs/taro';\nimport classnames from 'classnames'\nimport './index.scss'\nimport FlagSelector from '../../components/flagSelector';\nimport IconFont from '../../components/iconfont';\n\nexport default function Index() {\n  var hotelName = '上海虹桥国展地铁站@酒店';\n  var hotelId = '00001';\n  // useLoad(() => {\n  //   hotelName = 'XXX酒店';\n  //   hotelId = '00001'\n  // })\n  const [cScore, setCScore] = useState(0);\n  const [cText, setCText] = useState('');\n  const [cImgs, setCImgs] = useState([]);\n  const IMG_MAX_COUNT = 9;\n\n  const addImg = async () => {\n    console.log(\"addImg\")\n    var imgs = [...cImgs]\n    const res = await Taro.chooseImage({ count: IMG_MAX_COUNT - cImgs.length, sizeType: ['compressed'] })\n    for (let path of res.tempFilePaths) {\n      let cloudPath = 'comment-img/' + Date.now() + Math.floor(Math.random() * 10000) + '.jpg';\n      await Taro.cloud.uploadFile({ cloudPath: cloudPath, filePath: path }).then(\n        (res) => {\n          imgs.push(res.fileID)\n        }\n      )\n    }\n    setCImgs(imgs)\n  }\n  const deleteImg = (index) => {\n    console.log(\"deleteImg\" + index)\n    var imgs = [...cImgs]\n    var newCImg = []\n    for (let i = 0; i < imgs.length; i++) {\n      if (i != index) {\n        newCImg.push(imgs[i])\n      }\n    }\n    setCImgs(newCImg)\n  }\n\n  const submitComment = async () => {\n    console.log(\"clicked submit\")\n    if (cScore == 0) {\n      Taro.showToast({ title: '请先评分', icon: 'error', duration: 1000 })\n      return;\n    }\n    if (cText.length < 5) {\n      Taro.showToast({ title: '评价字数过少', icon: 'error', duration: 1000 })\n      return;\n    }\n    Taro.showModal({\n      title: '确认提交评价？',\n      success: (res) => {\n        if (res.confirm) {\n          console.log(\"submit to server...\")\n          Taro.showLoading({\n            title: '提交评价ing...'\n          })\n          Taro.cloud.callFunction({\n            name: 'submit-comment',\n            data: {\n              hotelName: hotelName,\n              hotelId: hotelId,\n              comment: {\n                score: cScore,\n                text: cText,\n                imgs: cImgs\n              }\n            }\n          }).then((res) => {\n            Taro.hideLoading()\n            if (res.errMsg != \"cloud.callFunction:ok\") {\n              Taro.showToast({ title: '提交失败', icon: 'error', duration: 1000 })\n            } else {\n              Taro.showToast({ title: '提交成功', icon: 'success', duration: 1000 })\n            }\n          })\n        }\n      }\n    })\n\n  }\n\n  return (\n    <View className='comment-submit-page'>\n      <View className='hotel-name'>{hotelName}</View>\n\n      <View className='comment-score'>\n        <Text className='score-title'>评分：</Text>\n        <View className='stars'>{[1, 2, 3, 4, 5].map((value) => {\n          let colour = value <= cScore ? 'yellow' : \"#ccc\"\n          return (<View onClick={() => { setCScore(value) }} >\n            <IconFont className='star' name='a-1' color={colour} size=\"60rpx\" />\n          </View>)\n        })}</View>\n      </View>\n\n      <View className='comment-text'>\n        <Text className='text-tips1'>{cText == '' ? '欢迎你分享对酒店服务、环境、设施和价格等的评价...' : ''}</Text>\n        <Input className='text-content' value={cText} type='text' onInput={(e) => { setCText(e.target.value) }} />\n        <View className='text-tips2'>至少5个字</View>\n      </View>\n\n      <View className='comment-imgs'>{cImgs.map((src, index) => (\n        <View className='img-container'>\n          <Image src={src} className='comment-img'></Image>\n          <View className='delete-btn' onClick={() => { deleteImg(index) }}>\n            <IconFont name='times-circle-fill' size='32rpx' color='red'></IconFont>\n          </View>\n        </View>\n      ))}\n        {cImgs.length < IMG_MAX_COUNT && <View className='img-container'><Image src='https://pic.imgdb.cn/item/6434ffef0d2dde577737f3bf.jpg' className='comment-img' onClick={addImg}></Image></View>}\n      </View>\n\n      <Button className='submit-btn' onClick={submitComment}>提交</Button>\n    </View>\n  )\n\n}\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/babel-loader/lib/index.js??ruleSet[1].rules[5].use[0]!./index.jsx\"\nvar config = {\"navigationBarTitleText\":\"点评提交\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/comment-submit/index', {root:{cn:[]}}, config || {}))\n\n\n","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","import unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nexport default function _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (!it) {\n    if (Array.isArray(o) || (it = unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n      var F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var normalCompletion = true,\n    didErr = false,\n    err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}"],"names":[],"sourceRoot":""}