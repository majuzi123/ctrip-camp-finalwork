{"version":3,"file":"index.js","sources":["../../../../src/api/media/video/index.ts"],"sourcesContent":["import Taro from '@tarojs/api'\n\nimport { findDOM, shouldBeObject, temporarilyNotSupport } from '../../../utils'\nimport { MethodHandler } from '../../../utils/handler'\n\n// 视频\nexport const saveVideoToPhotosAlbum = temporarilyNotSupport('saveVideoToPhotosAlbum')\nexport const openVideoEditor = temporarilyNotSupport('openVideoEditor')\nexport const getVideoInfo = temporarilyNotSupport('getVideoInfo')\n\n/**\n * 创建 video 上下文 VideoContext 对象。\n */\nexport const createVideoContext: typeof Taro.createVideoContext = (id, inst) => {\n  const el = findDOM(inst) as HTMLVideoElement\n  // TODO HTMLVideoElement to VideoContext\n  return el?.querySelector(`taro-video-core[id=${id}]`) as unknown as Taro.VideoContext\n}\n\nexport const compressVideo = temporarilyNotSupport('compressVideo')\n\n/**\n * 拍摄视频或从手机相册中选视频。\n */\nexport const chooseVideo: typeof Taro.chooseVideo = (options) => {\n  // options must be an Object\n  const isObject = shouldBeObject(options)\n  if (!isObject.flag) {\n    const res = { errMsg: `chooseVideo:fail ${isObject.msg}` }\n    console.error(res.errMsg)\n    return Promise.reject(res)\n  }\n\n  const { success, fail, complete } = options\n  const handle = new MethodHandler<Taro.chooseVideo.SuccessCallbackResult>({ name: 'chooseVideo', success, fail, complete })\n  const res: Partial<Taro.chooseVideo.SuccessCallbackResult> = {\n    tempFilePath: '',\n    duration: 0,\n    size: 0,\n    height: 0,\n    width: 0\n  }\n\n  const inputEl = document.createElement('input')\n  inputEl.setAttribute('type', 'file')\n  inputEl.setAttribute('multiple', 'multiple')\n  inputEl.setAttribute('accept', 'video/*')\n  inputEl.setAttribute('style', 'position: fixed; top: -4000px; left: -3000px; z-index: -300;')\n  document.body.appendChild(inputEl)\n\n  return new Promise<Taro.chooseVideo.SuccessCallbackResult>((resolve, reject) => {\n    const TaroMouseEvents = document.createEvent('MouseEvents')\n    TaroMouseEvents.initEvent('click', true, true)\n    inputEl.dispatchEvent(TaroMouseEvents)\n    inputEl.onchange = function (e) {\n      const target = e.target as HTMLInputElement\n      const file = target.files?.[0]\n      const reader = new FileReader()\n      reader.onload = function (event: ProgressEvent<FileReader>) {\n        const videoEl = document.createElement('video')\n        const url = event.target?.result as string\n        videoEl.preload = 'metadata'\n        videoEl.src = url\n        videoEl.onloadedmetadata = () => {\n          res.tempFilePath = url\n          res.duration = videoEl.duration\n          res.size = event.total\n          res.height = videoEl.videoHeight\n          res.width = videoEl.videoHeight\n          return handle.success(res, { resolve, reject })\n        }\n      }\n      if (file) {\n        reader.readAsDataURL(file)\n      }\n    }\n  }).finally(() => {\n    document.body.removeChild(inputEl)\n  })\n}\n\nexport const chooseMedia = temporarilyNotSupport('chooseMedia')\n"],"names":[],"mappings":"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"}