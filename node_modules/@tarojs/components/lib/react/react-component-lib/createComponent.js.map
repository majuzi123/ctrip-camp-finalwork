{"version":3,"file":"createComponent.js","sources":["../../../../taro-components-library-react/src/react-component-lib/createComponent.tsx"],"sourcesContent":["import React, { createElement } from 'react';\n\nimport { attachProps, camelToDashCase, createForwardRef, dashToPascalCase, isCoveredByReact, mergeRefs } from './utils';\n\nexport interface HTMLStencilElement extends HTMLElement {\n  componentOnReady(): Promise<this>;\n}\n\ninterface StencilReactInternalProps<ElementType> extends React.HTMLAttributes<ElementType> {\n  forwardedRef: React.RefObject<ElementType>;\n  ref?: React.Ref<any>;\n}\n\nexport const createReactComponent = <\n  PropType,\n  ElementType extends HTMLStencilElement,\n  ContextStateType = {},\n  ExpandedPropsTypes = {}\n>(\n  tagName: string,\n  ReactComponentContext?: React.Context<ContextStateType>,\n  manipulatePropsFunction?: (\n    originalProps: StencilReactInternalProps<ElementType>,\n    propsToPass: any\n  ) => ExpandedPropsTypes,\n  defineCustomElement?: () => void\n) => {\n  if (defineCustomElement !== undefined) {\n    defineCustomElement();\n  }\n\n  const displayName = dashToPascalCase(tagName);\n  const ReactComponent = class extends React.Component<StencilReactInternalProps<ElementType>> {\n    componentEl!: ElementType;\n\n    setComponentElRef = (element: ElementType) => {\n      this.componentEl = element;\n    };\n\n    constructor(props: StencilReactInternalProps<ElementType>) {\n      super(props);\n    }\n\n    componentDidMount() {\n      this.componentDidUpdate(this.props);\n    }\n\n    componentDidUpdate(prevProps: StencilReactInternalProps<ElementType>) {\n      attachProps(this.componentEl, this.props, prevProps);\n    }\n\n    render() {\n      const { children, forwardedRef, className, ref, ...cProps } = this.props;\n\n      let propsToPass = Object.keys(cProps).reduce((acc: any, name) => {\n        const value = (cProps as any)[name];\n\n        if (name.indexOf('on') === 0 && name[2] === name[2].toUpperCase()) {\n          const eventName = name.substring(2).toLowerCase();\n          if (typeof document !== 'undefined' && isCoveredByReact(eventName)) {\n            acc[name] = value;\n          }\n        } else {\n          // we should only render strings, booleans, and numbers as attrs in html.\n          // objects, functions, arrays etc get synced via properties on mount.\n          const type = typeof value;\n\n          if (name !== 'style' && ['string', 'boolean', 'number'].includes(type)) {\n            acc[camelToDashCase(name)] = value;\n          }\n        }\n        return acc;\n      }, {} as ExpandedPropsTypes);\n\n      if (manipulatePropsFunction) {\n        propsToPass = manipulatePropsFunction(this.props, propsToPass);\n      }\n\n      const newProps: Omit<StencilReactInternalProps<ElementType>, 'forwardedRef'> = {\n        ...propsToPass,\n        ref: mergeRefs(forwardedRef, this.setComponentElRef),\n      };\n\n      /**\n       * We use createElement here instead of\n       * React.createElement to work around a\n       * bug in Vite (https://github.com/vitejs/vite/issues/6104).\n       * React.createElement causes all elements to be rendered\n       * as <tagname> instead of the actual Web Component.\n       */\n      return createElement(tagName, newProps, children);\n    }\n\n    static get displayName() {\n      return displayName;\n    }\n  };\n\n  // If context was passed to createReactComponent then conditionally add it to the Component Class\n  if (ReactComponentContext) {\n    ReactComponent.contextType = ReactComponentContext;\n  }\n\n  return createForwardRef<PropType, ElementType>(ReactComponent, displayName);\n};\n"],"names":[],"mappings":"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"}