{"version":3,"file":"index.js","sources":["../src/props.ts","../src/reconciler.ts","../src/render.ts","../src/index.ts"],"sourcesContent":["import { FormElement, Style, TaroElement } from '@tarojs/runtime'\nimport { capitalize, internalComponents, isFunction, isNumber, isObject, isString, toCamelCase } from '@tarojs/shared'\n\nexport type Props = Record<string, unknown>\n\nfunction isEventName (s: string) {\n  return s[0] === 'o' && s[1] === 'n'\n}\n\nconst IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i\n\nexport function updateProps (dom: TaroElement, oldProps: Props, newProps: Props) {\n  const updatePayload = getUpdatePayload(dom, oldProps, newProps)\n  if(updatePayload){\n    updatePropsByPayload(dom, oldProps, updatePayload)\n  }\n}\n\nexport function updatePropsByPayload (dom: TaroElement, oldProps: Props, updatePayload: any[]){\n  for(let i = 0; i < updatePayload.length; i += 2){ // key, value 成对出现\n    const key = updatePayload[i]; const newProp = updatePayload[i+1]; const oldProp = oldProps[key]\n    setProperty(dom, key, newProp, oldProp)\n  }\n}\n\nexport function getUpdatePayload (dom: TaroElement, oldProps: Props, newProps: Props){\n  let i: string\n  let updatePayload: any[] | null = null\n\n  for (i in oldProps) {\n    if (!(i in newProps)) {\n      (updatePayload = updatePayload || []).push(i, null)\n    }\n  }\n  const isFormElement = dom instanceof FormElement\n  for (i in newProps) {\n    if (oldProps[i] !== newProps[i] || (isFormElement && i === 'value')) {\n      (updatePayload = updatePayload || []).push(i, newProps[i])\n    }\n  }\n\n  return updatePayload\n}\n\n// function eventProxy (e: CommonEvent) {\n//   const el = document.getElementById(e.currentTarget.id)\n//   const handlers = el!.__handlers[e.type]\n//   handlers[0](e)\n// }\n\nfunction setEvent (dom: TaroElement, name: string, value: unknown, oldValue?: unknown) {\n  const isCapture = name.endsWith('Capture')\n  let eventName = name.toLowerCase().slice(2)\n  if (isCapture) {\n    eventName = eventName.slice(0, -7)\n  }\n\n  const compName = capitalize(toCamelCase(dom.tagName.toLowerCase()))\n\n  if (eventName === 'click' && compName in internalComponents) {\n    eventName = 'tap'\n  }\n\n  if (isFunction(value)) {\n    if (oldValue) {\n      dom.removeEventListener(eventName, oldValue as any, false)\n      dom.addEventListener(eventName, value, { isCapture, sideEffect: false })\n    } else {\n      dom.addEventListener(eventName, value, isCapture)\n    }\n  } else {\n    dom.removeEventListener(eventName, oldValue as any)\n  }\n}\n\nfunction setStyle (style: Style, key: string, value: string | number) {\n  if (key[0] === '-') {\n    style.setProperty(key, value.toString())\n    // css variables need not further judgment\n    return\n  }\n\n  style[key] =\n    isNumber(value) && IS_NON_DIMENSIONAL.test(key) === false\n      ? value + 'px'\n      : value == null\n        ? ''\n        : value\n}\n\ntype StyleValue = Record<string, string | number>\ninterface DangerouslySetInnerHTML {\n  __html?: string\n}\n\nfunction setProperty (dom: TaroElement, name: string, value: unknown, oldValue?: unknown) {\n  name = name === 'className' ? 'class' : name\n\n  if (\n    name === 'key' ||\n    name === 'children' ||\n    name === 'ref'\n  ) {\n    // skip\n  } else if (name === 'style') {\n    const style = dom.style\n    if (isString(value)) {\n      style.cssText = value\n    } else {\n      if (isString(oldValue)) {\n        style.cssText = ''\n        oldValue = null\n      }\n\n      if (isObject<StyleValue>(oldValue)) {\n        for (const i in oldValue) {\n          if (!(value && i in (value as StyleValue))) {\n            setStyle(style, i, '')\n          }\n        }\n      }\n\n      if (isObject<StyleValue>(value)) {\n        for (const i in value) {\n          if (!oldValue || value[i] !== (oldValue as StyleValue)[i]) {\n            setStyle(style, i, value[i])\n          }\n        }\n      }\n    }\n  } else if (isEventName(name)) {\n    setEvent(dom, name, value, oldValue)\n  } else if (name === 'dangerouslySetInnerHTML') {\n    const newHtml = (value as DangerouslySetInnerHTML)?.__html ?? ''\n    const oldHtml = (oldValue as DangerouslySetInnerHTML)?.__html ?? ''\n    if (newHtml || oldHtml) {\n      if (oldHtml !== newHtml) {\n        dom.innerHTML = newHtml\n      }\n    }\n  } else if (!isFunction(value)) {\n    if (value == null) {\n      dom.removeAttribute(name)\n    } else {\n      dom.setAttribute(name, value as string)\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/indent */\nimport { document, TaroElement, TaroText } from '@tarojs/runtime'\nimport { isBoolean, isUndefined, noop } from '@tarojs/shared'\nimport Reconciler, { HostConfig } from 'react-reconciler'\nimport { DefaultEventPriority } from 'react-reconciler/constants'\n\nimport { getUpdatePayload, Props, updateProps, updatePropsByPayload } from './props'\n\nconst hostConfig: HostConfig<\n  string, // Type\n  Props, // Props\n  TaroElement, // Container\n  TaroElement, // Instance\n  TaroText, // TextInstance\n  TaroElement, // SuspenseInstance\n  TaroElement, // HydratableInstance\n  TaroElement, // PublicInstance\n  Record<string, any>, // HostContext\n  string[], // UpdatePayload\n  unknown, // ChildSet\n  unknown, // TimeoutHandle\n  unknown // NoTimeout\n> & {\n  supportsMicrotasks: boolean  // 待官方类型文件修复后删除\n} = {\n  // below keys order by {React ReactFiberHostConfig.custom.js}, convenient for comparing each other.\n\n  // -------------------\n  // required by @types/react-reconciler\n  // -------------------\n  getPublicInstance (inst: TaroElement) {\n    return inst\n  },\n  getRootHostContext () {\n    return {}\n  },\n  getChildHostContext (parentHostContext) {\n    return parentHostContext\n  },\n  prepareForCommit (..._: any[]) {\n    return null\n  },\n  resetAfterCommit: noop,\n  createInstance (type) {\n    return document.createElement(type)\n  },\n  appendInitialChild (parent, child) {\n    parent.appendChild(child)\n  },\n  finalizeInitialChildren (dom, _, props: any) {\n    updateProps(dom, {}, props)  // 提前执行更新属性操作，Taro 在 Page 初始化后会立即从 dom 读取必要信息\n    return false\n  },\n  prepareUpdate (instance, _, oldProps, newProps) {\n    return getUpdatePayload(instance, oldProps, newProps)\n  },\n  shouldSetTextContent () {\n    return false\n  },\n  createTextInstance (text) {\n    return document.createTextNode(text)\n  },\n  scheduleTimeout: setTimeout,\n  cancelTimeout: clearTimeout,\n  noTimeout: -1,\n  isPrimaryRenderer: true,\n  warnsIfNotActing: true,\n  supportsMutation: true,\n  supportsPersistence: false,\n  supportsHydration: false,\n  getInstanceFromNode: () => null,\n  beforeActiveInstanceBlur: noop,\n  afterActiveInstanceBlur: noop,\n  preparePortalMount: noop,\n  prepareScopeUpdate: noop,\n  getInstanceFromScope: () => null,\n  getCurrentEventPriority () {\n    return DefaultEventPriority\n  },\n  detachDeletedInstance: noop,\n\n  // -------------------\n  //      Microtasks\n  //     (optional)\n  // -------------------\n  supportsMicrotasks: true,\n  scheduleMicrotask: isUndefined(Promise)\n    ? setTimeout\n    : (callback) =>\n        Promise.resolve(null)\n          .then(callback)\n          .catch(function (error) {\n            setTimeout(() => {\n              throw error\n            })\n          }),\n\n  // -------------------\n  //      Mutation\n  //     (required if supportsMutation is true)\n  // -------------------\n  appendChild (parent, child) {\n    parent.appendChild(child)\n  },\n  appendChildToContainer (parent, child) {\n    parent.appendChild(child)\n  },\n  commitTextUpdate (textInst, _, newText) {\n    textInst.nodeValue = newText\n  },\n  commitMount: noop,\n  commitUpdate (dom, updatePayload, _, oldProps) {\n    updatePropsByPayload(dom, oldProps, updatePayload)\n  },\n  insertBefore (parent, child, refChild) {\n    parent.insertBefore(child, refChild)\n  },\n  insertInContainerBefore (parent, child, refChild) {\n    parent.insertBefore(child, refChild)\n  },\n  removeChild (parent, child) {\n    parent.removeChild(child)\n  },\n  removeChildFromContainer (parent, child) {\n    parent.removeChild(child)\n  },\n  resetTextContent: noop,\n  hideInstance (instance) {\n    const style = instance.style\n    style.setProperty('display', 'none')\n  },\n  hideTextInstance (textInstance) {\n    textInstance.nodeValue = ''\n  },\n  unhideInstance (instance, props) {\n    const styleProp = props.style as {display?: any}\n    let display = styleProp?.hasOwnProperty('display') ? styleProp.display : null\n    display = display == null || isBoolean(display) || display === '' ? '' : ('' + display).trim()\n    // eslint-disable-next-line dot-notation\n    instance.style['display'] = display\n  },\n  unhideTextInstance (textInstance, text) {\n    textInstance.nodeValue = text\n  },\n  clearContainer (element) {\n    if (element.childNodes.length > 0) {\n      element.textContent = ''\n    }\n  },\n}\n\nconst TaroReconciler = Reconciler(hostConfig)\n\nif (process.env.NODE_ENV !== 'production') {\n  const foundDevTools = TaroReconciler.injectIntoDevTools({\n    bundleType: 1,\n    version: '18.0.0',\n    rendererPackageName: 'taro-react',\n  })\n  if (!foundDevTools) {\n    // eslint-disable-next-line no-console\n    console.info(\n      '%cDownload the React DevTools ' +\n        'for a better development experience: ' +\n        'https://reactjs.org/link/react-devtools',\n      'font-weight:bold'\n    )\n  }\n}\n\nexport { TaroReconciler }\n","import { TaroElement } from '@tarojs/runtime'\nimport { ReactNode } from 'react'\nimport { OpaqueRoot } from 'react-reconciler'\n\nimport { TaroReconciler } from './reconciler'\n\nexport const ContainerMap: WeakMap<TaroElement, Root> = new WeakMap()\n\ntype Renderer = typeof TaroReconciler\n\ntype CreateRootOptions = {\n  unstable_strictMode?: boolean\n  unstable_concurrentUpdatesByDefault?: boolean\n  unstable_transitionCallbacks?: any\n  identifierPrefix?: string\n  onRecoverableError?: (error: any) => void\n}\n\nexport type Callback = () => void | null | undefined\n\nclass Root {\n  private renderer: Renderer\n  private internalRoot: OpaqueRoot\n\n  public constructor (renderer: Renderer, domContainer: TaroElement, options?: CreateRootOptions) {\n    this.renderer = renderer\n    this.initInternalRoot(renderer, domContainer, options)\n  }\n\n  private initInternalRoot (renderer: Renderer, domContainer: TaroElement, options?: CreateRootOptions) {\n    // Since react-reconciler v0.27, createContainer need more parameters\n    // @see:https://github.com/facebook/react/blob/0b974418c9a56f6c560298560265dcf4b65784bc/packages/react-reconciler/src/ReactFiberReconciler.js#L248\n    const containerInfo = domContainer\n    if (options) {\n      const tag = 1 // ConcurrentRoot\n      const concurrentUpdatesByDefaultOverride = false\n      let isStrictMode = false\n      let identifierPrefix = ''\n      let onRecoverableError = (error: any) => console.error(error)\n      let transitionCallbacks = null\n      if (options.unstable_strictMode === true) {\n        isStrictMode = true\n      }\n      if (options.identifierPrefix !== undefined) {\n        identifierPrefix = options.identifierPrefix\n      }\n      if (options.onRecoverableError !== undefined) {\n        onRecoverableError = options.onRecoverableError\n      }\n      if (options.unstable_transitionCallbacks !== undefined) {\n        transitionCallbacks = options.unstable_transitionCallbacks\n      }\n\n      this.internalRoot = renderer.createContainer(\n        containerInfo,\n        tag,\n        null, // hydrationCallbacks\n        isStrictMode,\n        concurrentUpdatesByDefaultOverride,\n        identifierPrefix,\n        onRecoverableError,\n        transitionCallbacks\n      )\n    } else {\n      const tag = 0 // LegacyRoot\n      this.internalRoot = renderer.createContainer(\n        containerInfo,\n        tag,\n        null, // hydrationCallbacks\n        false, // isStrictMode\n        false, // concurrentUpdatesByDefaultOverride,\n        '', // identifierPrefix\n        () => {}, // onRecoverableError, this isn't reachable because onRecoverableError isn't called in the legacy API.\n        null // transitionCallbacks\n      )\n    }\n  }\n\n  public render (children: ReactNode, cb: Callback) {\n    const { renderer, internalRoot } = this\n    renderer.updateContainer(children, internalRoot, null, cb)\n    return renderer.getPublicRootInstance(internalRoot)\n  }\n\n  public unmount (cb: Callback) {\n    this.renderer.updateContainer(null, this.internalRoot, null, cb)\n  }\n}\n\nexport function render (element: ReactNode, domContainer: TaroElement, cb: Callback) {\n  const oldRoot = ContainerMap.get(domContainer)\n  if (oldRoot != null) {\n    return oldRoot.render(element, cb)\n  }\n\n  const root = new Root(TaroReconciler, domContainer)\n  ContainerMap.set(domContainer, root)\n  return root.render(element, cb)\n}\n\nexport function createRoot (domContainer: TaroElement, options: CreateRootOptions = {}) {\n  const oldRoot = ContainerMap.get(domContainer)\n  if (oldRoot != null) {\n    return oldRoot\n  }\n  // options should be an object\n  const root = new Root(TaroReconciler, domContainer, options)\n  ContainerMap.set(domContainer, root)\n  return root\n}\n","/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { TaroElement } from '@tarojs/runtime'\nimport { ensure, isFunction } from '@tarojs/shared'\nimport { ReactNode } from 'react'\n\nimport { TaroReconciler } from './reconciler'\nimport { ContainerMap, createRoot, render } from './render'\n\nconst unstable_batchedUpdates = TaroReconciler.batchedUpdates\n\nfunction unmountComponentAtNode (dom: TaroElement) {\n  ensure(dom && [1, 8, 9, 11].includes(dom.nodeType), 'unmountComponentAtNode(...): Target container is not a DOM element.')\n\n  const root = ContainerMap.get(dom)\n\n  if (!root) return false\n\n  unstable_batchedUpdates(() => {\n    root.unmount(() => {\n      ContainerMap.delete(dom)\n    })\n  }, null)\n\n  return true\n}\n\nfunction findDOMNode (comp?: TaroElement | ReactNode) {\n  if (comp == null) {\n    return null\n  }\n\n  const nodeType = (comp as TaroElement).nodeType\n  if (nodeType === 1 || nodeType === 3) {\n    return comp\n  }\n\n  return TaroReconciler.findHostInstance(comp as Record<string, any>)\n}\n\nconst portalType = isFunction(Symbol) && Symbol.for\n  ? Symbol.for('react.portal')\n  : 0xeaca\n\nfunction createPortal (\n  children: ReactNode,\n  containerInfo: TaroElement,\n  key?: string\n) {\n  return {\n    $$typeof: portalType,\n    key: key == null ? null : String(key),\n    children,\n    containerInfo,\n    implementation: null\n  }\n}\n\nexport {\n  createPortal,\n  createRoot,\n  findDOMNode,\n  render,\n  unmountComponentAtNode,\n  unstable_batchedUpdates\n}\n\nexport default {\n  render,\n  createRoot,\n  unstable_batchedUpdates,\n  unmountComponentAtNode,\n  findDOMNode,\n  createPortal\n}\n"],"names":["const","let","FormElement","capitalize","toCamelCase","internalComponents","isFunction","isNumber","isString","isObject","i","noop","document","DefaultEventPriority","isUndefined","isBoolean","Reconciler","tag","ensure"],"mappings":"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"}