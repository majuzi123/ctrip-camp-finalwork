{"version":3,"file":"index.js","sources":["../../../src/components/pull-down-refresh/index.tsx"],"sourcesContent":["import './style/index.css'\r\n\r\nimport Taro from '@tarojs/taro'\r\nimport classNames from 'classnames'\r\nimport React from 'react'\r\n\r\nfunction setTransform (nodeStyle, value) {\r\n  nodeStyle.transform = value\r\n  nodeStyle.webkitTransform = value\r\n  nodeStyle.MozTransform = value\r\n}\r\n\r\nconst isWebView =\r\n  typeof navigator !== 'undefined' && /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent)\r\n\r\nenum PullDownState {\r\n  activate = 'activate',\r\n  deactivate = 'deactivate',\r\n  release = 'release',\r\n  finish = 'finish'\r\n}\r\n\r\nenum INDICATOR {\r\n  activate = 'release',\r\n  deactivate = 'pull',\r\n  release = 'loading',\r\n  finish = 'finish'\r\n}\r\n\r\nlet supportsPassive = false\r\ntry {\r\n  const opts = Object.defineProperty({}, 'passive', {\r\n    get () {\r\n      supportsPassive = true\r\n    }\r\n  })\r\n  window.addEventListener('cancel', () => ({}), opts)\r\n} catch (e) {} // eslint-disable-line no-empty\r\n\r\nconst willPreventDefault = supportsPassive ? { passive: false } : false\r\n\r\ninterface IProps extends React.HTMLAttributes<HTMLBaseElement> {\r\n  prefixCls: string\r\n  distanceToRefresh: number\r\n  damping: number\r\n  indicator: INDICATOR\r\n  onRefresh?: () => void\r\n}\r\n\r\ninterface IState {\r\n  currSt: PullDownState\r\n  dragOnEdge: boolean\r\n}\r\n\r\nclass PullDownRefresh extends React.Component<IProps, IState> {\r\n  static defaultProps = {\r\n    prefixCls: 'rmc-pull-to-refresh',\r\n    distanceToRefresh: 50,\r\n    damping: 100,\r\n    indicator: INDICATOR\r\n  }\r\n\r\n  // https://github.com/yiminghe/zscroller/blob/2d97973287135745818a0537712235a39a6a62a1/src/Scroller.js#L355\r\n  // currSt: `activate` / `deactivate` / `release` / `finish`\r\n  state = {\r\n    currSt: PullDownState.deactivate,\r\n    dragOnEdge: false\r\n  }\r\n\r\n  containerRef: HTMLElement | null\r\n  contentRef: HTMLDivElement | null\r\n  _to: Record<string, EventListener>\r\n  _ScreenY = 0\r\n  _startScreenY = 0\r\n  _lastScreenY = 0\r\n  _isMounted = false\r\n  listeners: [string, (...args: any[]) => void][] = []\r\n\r\n  get scrollContainer () {\r\n    return (\r\n      this.contentRef?.parentElement ||\r\n      this.contentRef?.closest('.taro_page_stationed') ||\r\n      document.querySelector('.taro_page_stationed') ||\r\n      document.querySelector('.taro_page') ||\r\n      document.querySelector('.taro_router') ||\r\n      document.querySelector('.taro-tabbar__panel') ||\r\n      document.body\r\n    )\r\n  }\r\n\r\n  componentDidMount () {\r\n    this.init()\r\n    this._isMounted = true\r\n    this.listeners = [\r\n      [\r\n        '__taroStartPullDownRefresh',\r\n        ({ successHandler, errorHandler }) => {\r\n          try {\r\n            this.triggerPullDownRefresh(true)\r\n            successHandler({\r\n              errMsg: 'startPullDownRefresh: ok'\r\n            })\r\n          } catch (e) {\r\n            errorHandler({\r\n              errMsg: 'startPullDownRefresh: fail'\r\n            })\r\n          }\r\n        }\r\n      ],\r\n      [\r\n        '__taroStopPullDownRefresh',\r\n        ({ successHandler, errorHandler }) => {\r\n          try {\r\n            this.triggerPullDownRefresh(false)\r\n            successHandler({\r\n              errMsg: 'stopPullDownRefresh: ok'\r\n            })\r\n          } catch (e) {\r\n            errorHandler({\r\n              errMsg: 'stopPullDownRefresh: fail'\r\n            })\r\n          }\r\n        }\r\n      ]\r\n    ]\r\n    this.listeners.forEach(([evtName, callback]) => {\r\n      Taro.eventCenter.on(evtName, callback)\r\n    })\r\n  }\r\n\r\n  componentWillUnmount () {\r\n    this.destroy()\r\n    this.listeners.forEach(([evtName, callback]) => {\r\n      Taro.eventCenter.off(evtName, callback)\r\n    })\r\n  }\r\n\r\n  componentDidUpdate (_, prevState: IState) {\r\n    if (prevState.currSt !== this.state.currSt) {\r\n      const pageEl: any = this.scrollContainer\r\n      switch (this.state.currSt) {\r\n        case PullDownState.release:\r\n          pageEl?.__page?.onPullDownRefresh?.()\r\n          break\r\n        case PullDownState.deactivate:\r\n          pageEl?.__page?.onPullIntercept?.()\r\n      }\r\n    }\r\n  }\r\n\r\n  triggerPullDownRefresh = (flag: boolean) => {\r\n    // 在初始化时、用代码 自动 触发 pullDownRefresh\r\n    // 添加this._isMounted的判断，否则组建一实例化，currSt就会是finish\r\n    if (!this.state.dragOnEdge && this._isMounted) {\r\n      if (flag) {\r\n        this._lastScreenY = this.props.distanceToRefresh + 1\r\n        // change dom need after setState\r\n        this.setState({ currSt: PullDownState.release }, () => this.setContentStyle(this._lastScreenY))\r\n      } else {\r\n        this.setState({ currSt: PullDownState.finish }, () => this.reset())\r\n      }\r\n    }\r\n  }\r\n\r\n  init = () => {\r\n    const ele = this.scrollContainer\r\n    this._to = {\r\n      touchstart: this.onTouchStart.bind(this, ele),\r\n      touchmove: this.onTouchMove.bind(this, ele),\r\n      touchend: this.onTouchEnd.bind(this, ele),\r\n      touchcancel: this.onTouchEnd.bind(this, ele)\r\n    }\r\n    Object.keys(this._to).forEach(key => {\r\n      ele.addEventListener(key, this._to[key], willPreventDefault)\r\n    })\r\n  }\r\n\r\n  destroy = () => {\r\n    const ele = this.scrollContainer\r\n    Object.keys(this._to).forEach(key => {\r\n      ele.removeEventListener(key, this._to[key])\r\n    })\r\n  }\r\n\r\n  onTouchStart = (_, e: TouchEvent) => {\r\n    this._ScreenY = this._startScreenY = e.touches[0].screenY\r\n    // 一开始 refreshing 为 true 时 this._lastScreenY 有值\r\n    this._lastScreenY = this._lastScreenY || 0\r\n  }\r\n\r\n  isEdge = (ele: HTMLElement) => {\r\n    const container = this.scrollContainer\r\n    if (container && container === document.body) {\r\n      // In chrome61 `document.body.scrollTop` is invalid\r\n      const scrollNode = document.scrollingElement ? document.scrollingElement : document.body\r\n      return scrollNode.scrollTop <= 0\r\n    }\r\n    return ele.scrollTop <= 0\r\n  }\r\n\r\n  damping = (dy: number) => {\r\n    if (Math.abs(this._lastScreenY) > this.props.damping) {\r\n      return 0\r\n    }\r\n\r\n    const ratio = Math.abs(this._ScreenY - this._startScreenY) / window.screen.height\r\n    dy *= (1 - ratio) * 0.6\r\n\r\n    return dy\r\n  }\r\n\r\n  onTouchMove = (ele: HTMLElement, e: TouchEvent) => {\r\n    // 使用 pageY 对比有问题\r\n    const _screenY = e.touches[0].screenY\r\n\r\n    // 拖动方向不符合的不处理\r\n    if (this._startScreenY > _screenY) {\r\n      return\r\n    }\r\n\r\n    if (this.isEdge(ele)) {\r\n      if (!this.state.dragOnEdge) {\r\n        // 当用户开始往上滑的时候isEdge还是false的话，会导致this._ScreenY不是想要的，只有当isEdge为true时，再上滑，才有意义\r\n        // 下面这行代码解决了上面这个问题\r\n        this._ScreenY = this._startScreenY = e.touches[0].screenY\r\n        this.setState({ dragOnEdge: true })\r\n      }\r\n      if (e.cancelable) {\r\n        e.preventDefault()\r\n      }\r\n      // add stopPropagation with fastclick will trigger content onClick event. why?\r\n      // ref https://github.com/ant-design/ant-design-mobile/issues/2141\r\n      // e.stopPropagation();\r\n\r\n      const _diff = Math.round(_screenY - this._ScreenY)\r\n      this._ScreenY = _screenY\r\n      this._lastScreenY += this.damping(_diff)\r\n\r\n      this.setContentStyle(this._lastScreenY)\r\n\r\n      if (Math.abs(this._lastScreenY) < this.props.distanceToRefresh) {\r\n        if (this.state.currSt !== PullDownState.deactivate) {\r\n          // console.log('back to the distance');\r\n          this.setState({ currSt: PullDownState.deactivate })\r\n        }\r\n      } else {\r\n        if (this.state.currSt === PullDownState.deactivate) {\r\n          // console.log('reach to the distance');\r\n          this.setState({ currSt: PullDownState.activate })\r\n        }\r\n      }\r\n\r\n      // https://github.com/ant-design/ant-design-mobile/issues/573#issuecomment-339560829\r\n      // iOS UIWebView issue, It seems no problem in WKWebView\r\n      if (isWebView && e.changedTouches[0].clientY < 0) {\r\n        this.onTouchEnd()\r\n      }\r\n    }\r\n  }\r\n\r\n  onTouchEnd = () => {\r\n    if (this.state.dragOnEdge) {\r\n      this.setState({ dragOnEdge: false })\r\n    }\r\n    if (this.state.currSt === PullDownState.activate) {\r\n      this.setState({ currSt: PullDownState.release })\r\n      this.props.onRefresh?.()\r\n      this._lastScreenY = this.props.distanceToRefresh + 1\r\n      this.setContentStyle(this._lastScreenY)\r\n    } else if (this.state.currSt === 'release') {\r\n      this._lastScreenY = this.props.distanceToRefresh + 1\r\n      this.setContentStyle(this._lastScreenY)\r\n    } else {\r\n      this.reset()\r\n    }\r\n  }\r\n\r\n  reset = () => {\r\n    this._lastScreenY = 0\r\n    this.setContentStyle(0)\r\n  }\r\n\r\n  setContentStyle = ty => {\r\n    // TODO: Why sometimes do not have `this.contentRef` ?\r\n    if (this.contentRef) {\r\n      // translate3d 不清理 会影响内部元素定位\r\n      if (ty) {\r\n        setTransform(this.contentRef.style, `translate3d(0px,${ty}px,0)`)\r\n      } else {\r\n        setTransform(this.contentRef.style, '')\r\n      }\r\n    }\r\n  }\r\n\r\n  render () {\r\n    const props: Partial<IProps> & {\r\n      children?: React.ReactNode\r\n    } = { ...this.props }\r\n    delete props.damping\r\n    delete props.indicator\r\n    delete props.distanceToRefresh\r\n    delete props.onRefresh\r\n\r\n    const { className, prefixCls, children, ...restProps } = props\r\n\r\n    const renderRefresh = (cls: string) => {\r\n      const { currSt, dragOnEdge } = this.state\r\n      const cla = classNames(cls, !dragOnEdge && `${prefixCls}-transition`)\r\n      const showIndicator = currSt === 'activate' || currSt === 'release'\r\n      return (\r\n        <div className={`${prefixCls}-content-wrapper`}>\r\n          <div\r\n            className={cla}\r\n            ref={el => {\r\n              this.contentRef = el\r\n            }}\r\n          >\r\n            {showIndicator && (\r\n              <div className={`${prefixCls}-indicator`}>\r\n                <div />\r\n                <div />\r\n                <div />\r\n              </div>\r\n            )}\r\n            {children}\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n\r\n    if (this.scrollContainer) {\r\n      return renderRefresh(`${prefixCls}-content ${prefixCls}-down`)\r\n    }\r\n    return (\r\n      <pull-down-refresh\r\n        ref={el => {\r\n          this.containerRef = el\r\n        }}\r\n        className={classNames(className, prefixCls, `${prefixCls}-down`)}\r\n        {...restProps}\r\n      >\r\n        {renderRefresh(`${prefixCls}-content`)}\r\n      </pull-down-refresh>\r\n    )\r\n  }\r\n}\r\n\r\nexport default PullDownRefresh\r\n"],"names":["setTransform","nodeStyle","value","transform","webkitTransform","MozTransform","isWebView","navigator","test","userAgent","PullDownState","INDICATOR","supportsPassive","opts","Object","defineProperty","get","window","addEventListener","e","willPreventDefault","passive","PullDownRefresh","state","currSt","deactivate","dragOnEdge","_ScreenY","_startScreenY","_lastScreenY","_isMounted","listeners","triggerPullDownRefresh","flag","props","distanceToRefresh","setState","release","setContentStyle","finish","reset","init","ele","scrollContainer","_to","touchstart","onTouchStart","bind","touchmove","onTouchMove","touchend","onTouchEnd","touchcancel","keys","forEach","key","destroy","removeEventListener","_","touches","screenY","isEdge","container","document","body","scrollNode","scrollingElement","scrollTop","damping","dy","Math","abs","ratio","screen","height","_screenY","cancelable","preventDefault","_diff","round","activate","changedTouches","clientY","_b","onRefresh","ty","contentRef","style","_a","parentElement","closest","querySelector","successHandler","errorHandler","errMsg","evtName","callback","Taro","eventCenter","on","off","prevState","pageEl","__page","onPullDownRefresh","call","_d","_c","onPullIntercept","assign","indicator","className","prefixCls","children","restProps","__rest","renderRefresh","cls","cla","classNames","showIndicator","React","createElement","ref","el","containerRef","Component","defaultProps"],"mappings":"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"}