{"version":3,"file":"index.js","sources":["../../../src/components/image/index.tsx"],"sourcesContent":["import 'weui'\nimport './style/index.css'\n\nimport classNames from 'classnames'\nimport React from 'react'\n\nrequire('intersection-observer')\n\ninterface IProps extends React.HTMLAttributes<HTMLDivElement> {\n  src: string\n  mode: string\n  onError: () => void\n  onLoad: (e) => void\n  lazyLoad?: boolean\n  imgProps?: Record<string, any>\n}\n\nclass Image extends React.Component<IProps> {\n  constructor (props) {\n    super(props)\n    this.state = {\n      isLoaded: false\n    }\n    this.imageOnLoad = this.imageOnLoad.bind(this)\n    // this.observer = {}\n  }\n\n  observer: any = {}\n  imgRef: any = null\n\n  componentDidMount () {\n    if (this.props.lazyLoad) {\n      this.observer = new IntersectionObserver(\n        entries => {\n          // 异步 api 关系\n          if (entries[entries.length - 1].isIntersecting) {\n            this.setState({ isLoaded: true }, () => {\n              // findDOMNode(this).children[0].src = this.props.src\n              this.imgRef.src = this.props.src\n            })\n          }\n        },\n        {\n          rootMargin: '300px 0px'\n        }\n      )\n      this.observer.observe(this.imgRef)\n    }\n  }\n\n  componentWillUnmount () {\n    this.observer.disconnect && this.observer.disconnect()\n  }\n\n  imageOnLoad (e) {\n    const { onLoad } = this.props\n    Object.defineProperty(e, 'detail', {\n      enumerable: true,\n      writable: true,\n      value: {\n        width: e.target.width,\n        height: e.target.height\n      }\n    })\n\n    onLoad && onLoad(e)\n  }\n\n  render () {\n    const {\n      className,\n      style = {},\n      src,\n      mode,\n      onError,\n      lazyLoad,\n      imgProps,\n      ...reset\n    } = this.props\n    const cls = classNames(\n      'taro-img',\n      {\n        'taro-img__widthfix': mode === 'widthFix'\n      },\n      className\n    )\n    const imgCls = classNames(\n      'taro-img__mode-' +\n        (mode || 'scaleToFill').toLowerCase().replace(/\\s/g, '')\n    )\n\n    return (\n      <div className={cls} style={style} {...reset}>\n        {lazyLoad ? (\n          <img\n            ref={img => (this.imgRef = img)}\n            className={imgCls}\n            data-src={src}\n            onLoad={this.imageOnLoad}\n            onError={onError}\n            {...imgProps}\n          />\n        ) : (\n          <img\n            ref={img => (this.imgRef = img)}\n            className={imgCls}\n            src={src}\n            onLoad={this.imageOnLoad}\n            onError={onError}\n            {...imgProps}\n          />\n        )}\n      </div>\n    )\n  }\n}\n\nexport default Image\n"],"names":["require","Image","props","observer","imgRef","state","isLoaded","imageOnLoad","bind","lazyLoad","IntersectionObserver","entries","length","isIntersecting","setState","src","rootMargin","observe","disconnect","e","onLoad","Object","defineProperty","enumerable","writable","value","width","target","height","_a","className","style","mode","onError","imgProps","reset","__rest","cls","classNames","imgCls","toLowerCase","replace","React","createElement","assign","ref","img","Component"],"mappings":"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"}